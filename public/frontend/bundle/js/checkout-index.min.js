/******/ (() => { // webpackBootstrap
var __webpack_exports__ = {};
/*!*****************************************************!*\
  !*** ./resources/src/frontend/js/checkout-index.js ***!
  \*****************************************************/
$(function () {
  var HANDLE_CHECKOUT = {
    init: function init() {
      HANDLE_CHECKOUT.getShippingRateByShippingOptions();
      HANDLE_CHECKOUT.onSubmit();
      HANDLE_CHECKOUT.onExpandContentShippingOption();
      HANDLE_CHECKOUT.onExpandContentPaymentOption();
      HANDLE_CHECKOUT.onBeforeLoad();
      HANDLE_CHECKOUT.initEventTrigger();
      HANDLE_CHECKOUT.onToggleSummary();
    },
    initEventTrigger: function initEventTrigger() {
      $('[name="shipping_option_id"]:checked').trigger('change');
      $('[name="payment_option_id"]:checked').trigger('change');
    },
    onBeforeLoad: function onBeforeLoad() {},
    onToggleSummary: function onToggleSummary() {
      $('.order-summary-toggle').on('click', function () {
        var isExpand = $(this).hasClass('order-summary-toggle-show');
        $(this).toggleClass('order-summary-toggle-show', !isExpand);
        $(this).toggleClass('order-summary-toggle-hide', isExpand);
        $('.order-summary').toggleClass('order-summary-is-expanded', !isExpand);
        $('.order-summary').toggleClass('order-summary-is-collapsed', isExpand);
      });
    },
    getShippingRateByShippingOptions: function getShippingRateByShippingOptions() {
      var cartUuid = $('[name="checkout_cart_uuid"]').val();
      var countPaymentOptions = $('[name="shipping_option_id"]').length;
      var addressId = $('#user_address').attr('data-address-id');
      var calculated = 0;
      $('[name="shipping_option_id"]').each(function (_, element) {
        var option = $(element).val();
        $.ajax({
          url: CHECKOUT_ROUTES.api_user_checkout_provider_shipping_free.replace(':cartUuid', cartUuid),
          method: 'GET',
          data: {
            shipping_option_id: option,
            address_id: addressId
          },
          beforeSend: function beforeSend() {
            $("[shipping-rate-value-by-option=\"".concat(option, "\"]")).text('đang tính...');
          },
          success: function success(response) {
            HANDLE_CHECKOUT.calculateOrderByShippingRate(response, option);
            HANDLE_CHECKOUT.canorder(countPaymentOptions == ++calculated);
          }
        });
      });
    },
    canorder: function canorder() {
      var bool = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;
      $('[id="form-order"]').find('[type="submit"]').prop('disabled', !bool);
      $('[id="form-order"]').find('[type="submit"]').toggleClass('prevent', !bool);
      $('[id="form-order"]').find('[type="submit"] .btn-content').text(bool ? 'Đặt hàng' : 'Đang cập nhật');
    },
    calculateOrderByShippingRate: function calculateOrderByShippingRate(response, shoppingOptionId) {
      var transport_fee_formatted = response.transport_fee_formatted,
        total_estimated_amount_formatted = response.total_estimated_amount_formatted;
      $("[shipping-rate-value-by-option=\"".concat(shoppingOptionId, "\"]")).text(transport_fee_formatted);
      $("[name=\"shipping_option_id\"][value=\"".concat(shoppingOptionId, "\"]")).attr('data-fee-formatted', transport_fee_formatted);
      $("[name=\"shipping_option_id\"][value=\"".concat(shoppingOptionId, "\"]")).attr('data-order-estimate-grand-total', total_estimated_amount_formatted);
      $("[name=\"shipping_option_id\"]:checked").trigger('change');
    },
    onSubmit: function onSubmit() {
      $('[data-form="order"]').on('submit', function (e) {
        e.preventDefault();
        var cartUuid = $('[name="checkout_cart_uuid"]').val();
        var $form = $(this);
        var route = $form.attr('action');
        var payload = {
          shipping_option_id: $('[name="shipping_option_id"]:checked').val(),
          payment_option_id: $('[name="payment_option_id"]:checked').val(),
          address_id: $('#user_address').attr('data-address-id'),
          redirect_urls: {
            payment_success: CHECKOUT_ROUTES.web_user_checkout_with_payment_success.replace(':cart_uuid', cartUuid)
          }
        };
        $.ajax({
          url: route,
          method: 'POST',
          data: payload,
          beforeSend: function beforeSend() {
            $form.find('[type="submit"]').prop('disabled', true);
            $form.find('[type="submit"]').addClass('prevent');
          },
          success: function success(response) {
            var payment = response.payment,
              paying_confirmed = response.paying_confirmed,
              end_of_redirect_at = response.end_of_redirect_at;
            if (paying_confirmed) {
              window.location.href = end_of_redirect_at;
              return;
            }
            if (payment !== null && payment !== void 0 && payment.redirect_output) {
              var container = payment.redirect_output.container;
              if (container == 'redirect') {
                return HANDLE_CHECKOUT.handlePaymentRedirect(payment.redirect_output);
              } else if (container == 'html') {
                return HANDLE_CHECKOUT.handlePaymentHtml(payment.redirect_output);
              }
            }
          },
          error: function error() {
            $form.find('[type="submit"]').prop('disabled', false);
            $form.find('[type="submit"]').removeClass('prevent');
          }
        });
      });
    },
    onExpandContentShippingOption: function onExpandContentShippingOption() {
      $('[name="shipping_option_id"]').on('change', function () {
        var option = $(this).val();
        $('[data-expanded-content-shipping-option-id]').hide();
        $("[data-expanded-content-shipping-option-id=\"".concat(option, "\"]")).show();
        var grandTotal = $(this).attr('data-order-estimate-grand-total');
        var fee = $(this).attr('data-fee-formatted');
        $('[data-checkout-total-shipping-target]').text(fee);
        $('[data-checkout-payment-due-target]').text(grandTotal);
      });
    },
    onExpandContentPaymentOption: function onExpandContentPaymentOption() {
      $('[name="payment_option_id"]').on('change', function () {
        var option = $(this).val();
        $('[data-expanded-content-payment-option-id]').hide();
        $("[data-expanded-content-payment-option-id=\"".concat(option, "\"]")).show();
      });
    },
    handlePaymentRedirect: function handlePaymentRedirect(_ref) {
      var url = _ref.url;
      window.location.href = url;
    },
    handlePaymentHtml: function handlePaymentHtml(_ref2) {
      var html = _ref2.html,
        width = _ref2.width,
        height = _ref2.height,
        method = _ref2.method;
    }
  };
  HANDLE_CHECKOUT.init();
});
/******/ })()
;